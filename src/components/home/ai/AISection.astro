---
import SecondaryButton from "../../base/buttons/SecondaryButton.astro";
---

<section class="relative h-fit w-full text-center">
  <div class="flex flex-row">
    <div class="flex flex-col w-full px-12">
      <div class="flex gap-8">
        <div class="relative flex flex-1 aspect-video">
          <video
            id="videoBottom"
            class="absolute top-0 left-0 aspect-video rounded-xl object-cover"
            playsinline
            autoplay
            muted
            loop
            >e
            <source src="/example-video.mp4" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
          <video
            id="videoTop"
            class="absolute top-0 left-0 aspect-video rounded-xl object-cover"
            playsinline
            autoplay
            muted
            loop
          >
            <source src="/example-video.mp4" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
        <div class="flex flex-1 flex-col gap-4 text-start">
          <h2 class="text-ai-header">Flexible live stream utilities</h2>
          <p class="text-useCases-tileSubheader">
            Build powerful live stream experiences. Our programmable toolkit
            gives developers ultimate control over real-time video composition
            and dynamic content integration directly into their applications.
          </p>
          <div class="overflow-hidden flex grow">
            <div id="squares-container" class="flex gap-4" style="will-change: transform;">
              <div class="aspect-square h-full bg-red-900"></div>
              <div class="aspect-square h-full bg-green-900"></div>
              <div class="aspect-square h-full bg-blue-900"></div>
              <div class="aspect-square h-full bg-purple-900"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="flex mt-4">
        <div class="flex-1">
          <div
            class="border border-solid border-ai-border w-fit flex flex-1.5 rounded-xl p-px h-14"
          >
            <div
              class="relative z-0 flex h-full flex-col justify-center px-6 sm:px-7"
            >
            </div>
          </div>
        </div>
        <div class="flex-1"></div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  document.addEventListener('astro:page-load', () => {
    const container = document.getElementById('squares-container');
    if (!container) return;

    const squares = Array.from(container.children);
    const squareWidth = squares[0].offsetWidth;
    const gap = 16;

    console.log('SQUARES ', squares)

    // Clone squares for seamless looping
    squares.forEach((square) => {
      const clone = square.cloneNode(true);
      container.appendChild(clone);
    });

    // Set container width to accommodate all squares (originals + clones)
    // const totalWidth = (squareWidth + gap) * squares.length;
    // container.style.width = `${totalWidth * 2}px`;

    let position = 0;
    let animationId;

    // Animation function
    const animate = () => {
      position -= 1; // Speed of scrolling (adjust as needed)

      // Reset position when first set of squares is out of view
      if (position <= -totalWidth) {
        position = 0;
      }

      container.style.transform = `translateX(${position}px)`;
      animationId = requestAnimationFrame(animate);
    };

    // Start animation
    animationId = requestAnimationFrame(animate);

    // Optional: Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
    });
  });
</script>
