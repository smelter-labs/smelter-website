---
import Cross from "@assets/navigation/cross.svg";
import DiscordLogo from "@assets/navigation/discord-logo.svg";
import GithubLogo from "@assets/navigation/github-logo.svg";
import Hamburger from "@assets/navigation/hamburger.svg";
import NewScreen from "@assets/navigation/newscreen.svg";
import SmelterLogoSmall from "@assets/navigation/smelter-logo-small.svg";
import SmelterLogo from "@assets/navigation/smelter-logo.svg";
import NavButton from "@components/base/buttons/NavButton.astro";

interface Props {
  rootHref?: string;
}

const { rootHref = "https://smelter.dev/" } = Astro.props;
---

<header
  id="pageHeader"
  class="fixed z-50 w-screen max-w-screen bg-transparent transition-all ease-in-out duration-300"
>
  <nav class="flex h-18 md:h-20">
    <div
      class="flex justify-between items-center max-w-[1800px] w-full m-auto px-4 lg:px-10"
    >
      <a href={rootHref}>
        <SmelterLogo class="hidden md:block" />
        <SmelterLogoSmall class="md:hidden" />
      </a>

      <div class="lg:hidden flex justify-between items-center min-w-8 min-h-8">
        <button
          class="relative text-xl text-white min-w-8 min-h-8"
          aria-label="Toggle navigation"
          onclick="toggleMobileMenu()"
        >
          <Cross
            id="nav-close"
            class="absolute inset-0 fill-nav-icon aspect-square w-8 opacity-0 self-center"
          />
          <Hamburger
            id="nav-hamburger"
            class="absolute inset-0 fill-nav-icon aspect-square w-8 opacity-1 self-center"
          />
        </button>
      </div>

      <div
        id="mobile-menu"
        class="opacity-0 absolute -top-[1px] hidden left-0 w-full bg-[#161127EB] text-white z-20 mt-18 transition-all duration-300 ease-in-out"
      >
        <div class="flex flex-col items-start p-4">
          <a
            href="/react#features"
            onclick="toggleMobileMenu()"
            class="py-2 hover:underline text-nav-link w-full">Features</a
          >
          <a
            href="/react#pricing"
            onclick="toggleMobileMenu()"
            class="py-2 hover:underline text-nav-link w-full">Pricing</a
          >
          <a
            href="/docs"
            onclick="toggleMobileMenu()"
            class="py-2 hover:underline text-nav-link w-full"
            target="_blank">Docs</a
          >
          <a
            href="https://demo.smelter.dev/"
            target="_blank" 
            onclick="toggleMobileMenu()"
            class="py-2 hover:underline text-nav-link w-full">See a live demo</a
          >
          <a
            href="/react#pricing"
            onclick="toggleMobileMenu()"
            class="py-2 hover:underline text-nav-link w-full">Try it for free</a
          >
          <div class="flex gap-x-4 w-full justify-end py-2">
            <a
              href="https://discord.com/invite/Cxj3rzTTag"
              onclick="toggleMobileMenu()"
              target="_blank"
            >
              <DiscordLogo class="fill-nav-icon aspect-square w-5 md:w-6" />
            </a>
            <a
              href="https://github.com/software-mansion/smelter"
              onclick="toggleMobileMenu()"
              target="_blank"
            >
              <GithubLogo class="fill-nav-icon aspect-square w-5 md:w-6" />
            </a>
          </div>
        </div>
      </div>

      <div class="items-center hidden lg:flex">
        <div class="flex items-center">
          <div class="flex items-center gap-x-4 md:gap-x-6 mr-6 md:mr-8">
            <a href="/react#features" class="text-white hover:underline">
              Features
            </a>
            <a href="/react#pricing" class="text-white hover:underline">
              Pricing
            </a>
            <a href="/docs" class="text-white hover:underline flex flex-row gap-2 items-center" target="_blank">
              Docs
              <NewScreen />
            </a>
          </div>
          <div class="flex gap-x-2 md:gap-x-4 mr-6 md:mr-8">
            <a href="https://demo.smelter.dev/" target="_blank" >
              <NavButton> See a live demo </NavButton>
            </a>
            <a href="/react#pricing">
              <NavButton> Try it for free </NavButton>
            </a>
          </div>
        </div>

        <div class="flex gap-x-4">
          <a href="https://discord.com/invite/Cxj3rzTTag" target="_blank">
            <DiscordLogo class="fill-nav-icon aspect-square w-5 md:w-6" />
          </a>
          <a href="https://github.com/software-mansion/smelter" target="_blank">
            <GithubLogo class="fill-nav-icon aspect-square w-5 md:w-6" />
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<script is:inline data-astro-rerun>
  document.addEventListener("astro:page-load", function () {
    const header = document.getElementById("pageHeader");

    function handleOpacity() {
      const scrollDistanceLimit = 150;
      const alphaDecimal = Math.min(
        235,
        (window.scrollY / scrollDistanceLimit) * 235
      );
      const alphaHex = Math.round(alphaDecimal).toString(16).padStart(2, "0");
      if (header) header.style.backgroundColor = `#161127${alphaHex}`;
    }

    handleOpacity();

    window.addEventListener("scroll", handleOpacity);
  });

  function toggleMobileMenu() {
    const menu = document.getElementById("mobile-menu");
    const hamburger = document.getElementById("nav-hamburger");
    const close = document.getElementById("nav-close");
    const navbar = document.getElementById("pageHeader");

    if (menu.classList.contains("hidden")) {
      menu.classList.remove("hidden");

      hamburger.style.opacity = "0";
      close.style.opacity = "1";
      const alphaHex = Math.round(235).toString(16).padStart(2, "0");
      navbar.style.backgroundColor = `#161127${alphaHex}`;

      setTimeout(() => {
        menu.style.opacity = "1";
      }, 100);
    } else {
      menu.style.opacity = "0";
      hamburger.style.opacity = "1";
      close.style.opacity = "0";

      setTimeout(() => {
        menu.classList.add("hidden");
        const scrollDistanceLimit = 150;
        const alphaDecimal = Math.min(
          235,
          (window.scrollY / scrollDistanceLimit) * 235
        );
        const alphaHex = Math.round(alphaDecimal).toString(16).padStart(2, "0");
        navbar.style.backgroundColor = `#161127${alphaHex}`;
        menu.style.opacity = "1";
      }, 300);
    }
  }
</script>
