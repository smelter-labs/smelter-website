---
title: WHEP
---
import CollapsibleDetails from '@components/CollapsibleDetails.astro';

An output type that provides a WHEP server endpoint. It allows broadcasting a media stream to multiple clients simultaneously.

Smelter exposes WHEP endpoint on port 9000 under `/whep/:output_id` route. A different port can be
configured with [`SMELTER_WHIP_WHEP_SERVER_PORT`](/deployment/configuration#smelter_whip_whep_server_port).

To connect new output, register it first with [`register-output` request](/http-api/routes#register-output)
and then establish WHEP connection.

## Usage

To use WHEP Output you must register it first. You can do it by sending a request like this:

<CollapsibleDetails summaryTitle='Example request' open>

```http
POST: /api/output/:output_id/register
Content-Type: application/json

{
  "type": "whep",
  "video": {
    "resolution": { "width": 1280, "height": 720 },
    "encoder": { "type": "ffmpeg_h264" },
    "initial": {
      "root": {
        "type": "view"
      }
    }
  },
  "audio": {
    "encoder": { "type": "opus" },
    "channels": "stereo",
    "initial": {
      "inputs": [{ "input_id": "input_1", "volume": 1 }]
    }
  }
}
```
</CollapsibleDetails>

See [HTTP Routes](/http-api/routes#outputs-configuration) documentation to learn more about managing outputs.

## References

<CollapsibleDetails summaryTitle='Type definitions' open>

```tsx
type WhepOutput = {
  type: "whep";
  bearer_token?: string;
  video?: WhepVideoOptions;
  audio?: WhepAudioOptions;
}
```
</CollapsibleDetails>

## Properties

### bearer_token
Authentication token. If not provided, authentication is not required.

- **Type**: `string` 

---

### video
Parameters of a video included in the WHEP stream.

- **Type**: [`WhepVideoOptions`](#whepvideooptions)

---

### audio
Parameters of an audio included in the WHEP stream.

- **Type**: [`WhepAudioOptions`](#whepaudiooptions)

## WhepVideoOptions
<CollapsibleDetails summaryTitle='Type definitions' open>
```tsx
type WhepVideoOptions = {
  resolution: {
    width: u32;
    height: u32;
  };
  send_eos_when?: OutputEndCondition;
  encoder: WhepVideoEncoderOptions;
  initial: { root: Component; };
}
```
</CollapsibleDetails>

### Properties

#### resolution
Output resolution in pixels.

- **Type**: `{ width: u32; height: u32; }`

---

#### send_eos_when
Condition for termination of the output stream based on the input streams states. If output includes both audio and video streams, then EOS needs to be sent for every type.

- **Type**: [`OutputEndCondition`](#outputendcondition)

---

#### encoder
Video encoder options.

- **Type**: [`WhepVideoEncoderOptions`](#whepvideoencoderoptions)

---

#### initial
Root of a component tree/scene that should be rendered for the output. Use [`update_output`](/http-api/routes#update-output) request to update this value after registration.

- **Type**: `{ root: Component; }`


## WhepVideoEncoderOptions
<CollapsibleDetails summaryTitle='Type definitions' open>
```tsx
type WhepVideoEncoderOptions =
  | {
      type: "ffmpeg_h264";
      preset?:
        | "ultrafast"
        | "superfast"
        | "veryfast"
        | "faster"
        | "fast"
        | "medium"
        | "slow"
        | "slower"
        | "veryslow"
        | "placebo";
      pixel_format?: "yuv420p" | "yuv422p" | "yuv444p";
      ffmpeg_options?: Map<string, string>;
    }
  | {
      type: "ffmpeg_vp8";
      ffmpeg_options?: Map<string, string>;
    }
  | {
      type: "ffmpeg_vp9";
      pixel_format?: "yuv420p" | "yuv422p" | "yuv444p";
      ffmpeg_options?: Map<string, string>;
    };
```
</CollapsibleDetails>

### Properties (type: "ffmpeg_h264")

#### preset
Video output encoder preset. Visit <a href='https://trac.ffmpeg.org/wiki/Encode/H.264#Preset' target='_blank'>FFmpeg docs</a> to learn more.

- **Type**: `"ultrafast" | "superfast" | "veryfast" | "faster" | "fast" | "medium" | "slow" | "slower" | "veryslow" | "placebo"`
- **Default value**: `fast`
- **Supported values**:
  - `ultrafast`
  - `superfast`
  - `veryfast`
  - `faster`
  - `fast`
  - `medium`
  - `slow`
  - `slower`
  - `veryslow`
  - `placebo`

---

#### pixel_format
Encoder pixel format

- **Type**: `"yuv420p" | "yuv422p" | "yuv444p"`
- **Default value**: `yuv420p`
- **Supported values**:
  - `yuv420p`
  - `yuv422p`
  - `yuv444p`

---

#### ffmpeg_options
Raw FFmpeg encoder options. Visit <a href='https://ffmpeg.org/ffmpeg-codecs.html' target='_blank'>FFmpeg docs</a> to learn more.

- **Type**: `Map<string, string>`

### Properties (type: "ffmpeg_vp8")

#### ffmpeg_options
Raw FFmpeg encoder options. Visit <a href='https://ffmpeg.org/ffmpeg-codecs.html' target='_blank'>FFmpeg docs</a> to learn more.

- **Type**: `Map<string, string>`

### Properties (type: "ffmpeg_vp9")

#### pixel_format
Encoder pixel format

- **Type**: `"yuv420p" | "yuv422p" | "yuv444p"`
- **Default value**: `yuv420p`
- **Supported values**:
  - `yuv420p`
  - `yuv422p`
  - `yuv444p`

---

#### ffmpeg_options
Raw FFmpeg encoder options. Visit <a href='https://ffmpeg.org/ffmpeg-codecs.html' target='_blank'>FFmpeg docs</a> to learn more.

- **Type**: `Map<string, string>`

## WhepAudioOptions

<CollapsibleDetails summaryTitle='Type definitions' open>
```tsx
type WhepAudioOptions = {
  mixing_strategy?: "sum_clip" | "sum_scale";
  send_eos_when?: OutputEndCondition;
  encoder: WhepAudioEncoderOptions;
  channels?: "mono" | "stereo";
  initial: { inputs: InputAudio[]; };
}
```
</CollapsibleDetails>

### Properties

#### mixing_strategy
Specifies how audio should be mixed.

- **Type**: `"sum_clip" | "sum_scale"`
- **Default value**: `"sum_clip"`
- **Supported values**:
  - `sum_clip` - First, the input samples are summed. If the result exceeds the i16 PCM range, it is clipped.
  - `sum_scale` - First, the input samples are summed. If the result exceeds the i16 PCM range, the summed samples are scaled down by a factor to fit within the range.

---

#### send_eos_when
Condition for termination of the output stream based on the input streams states. If output includes both audio and video streams, then EOS needs to be sent for every type.

- **Type**: [`OutputEndCondition`](#outputendcondition)

---

#### encoder
Audio encoder options.

- **Type**: [`WhepAudioEncoderOptions`](#whepaudioencoderoptions)

---

#### channels
Channels configuration

- **Type**: `"mono" | "stereo"`
- **Default value**: `"stereo"`
- **Supported values**:
  - `mono` - Mono audio (single channel).
  - `stereo` - Stereo audio (two channels).


#### initial
Initial audio mixer configuration for output.

- **Type**: `{ inputs: InputAudio[]; }`

## WhepAudioEncoderOptions

<CollapsibleDetails summaryTitle='Type definitions' open>
```tsx
type WhepAudioEncoderOptions = {
  type: "opus";
  preset?: "quality" | "voip" | "lowest_latency";
  sample_rate?: u32;
  forward_error_correction?: bool;
  expected_packet_loss?: u32;
}
```
</CollapsibleDetails>

### Properties(type: "opus")

#### preset
Audio output encoder preset.

- **Type**: `"quality" | "voip" | "lowest_latency"`
- **Default value**: `voip`
- **Supported values**:
  - `quality` - Recommended for broadcast and high-fidelity applications requiring decoded audio to maintain maximum fidelity to the input signal.
  - `voip` - Recommended for VoIP and videoconferencing applications, prioritizing listening quality and speech intelligibility.
  - `lowest_latency` - Recommended **only** when achieving the lowest possible latency is the highest priority.

---

#### sample_rate
Sample rate.

- **Type**: `u32`
- **Default value**: `48000`
- **Supported values**: `8000`, `16000`, `24000`, `48000`

---

#### forward_error_correction
When enabled, include in-band forward error correction data to protect against packet loss. For more information, visit RFC specification sections [2.1.7](https://datatracker.ietf.org/doc/html/rfc6716#section-2.1.7)
and [4.2.5](https://datatracker.ietf.org/doc/html/rfc6716#section-4.2.5)

- **Type**: `bool`
- **Default value**: `false`

---

#### expected_packet_loss
Expected packet loss expressed as a percentage. This value controls how much redundant data is added to counteract packet loss (only when forward error correction is enabled).

- **Type**: `u32`
- **Default value**: `0`
- **Supported values**: `0-100`

## InputAudio

<CollapsibleDetails summaryTitle='Type definitions' open>
```tsx
type InputAudio = {
  input_id: string;
  volume?: f32;
}
```
</CollapsibleDetails>

### Properties

#### input_id
ID of an input. It identifies a stream registered using a [register input](/http-api/routes#register-input) method.

- **Type**: `string`

#### volume
Input volume in range `[0, 1]`

- **Type**: `f32`
- **Default value**: `1.0`
- **Supported values**: `[0, 1]`

## OutputEndCondition
This type defines when end of an input stream should trigger end of the output stream. Only one of those fields can be set at the time.
Unless specified otherwise the input stream is considered finished/ended when:
- TCP connection was dropped/closed.
- RTCP Goodbye packet (`BYE`) was received.
- Mp4 track has ended.
- Input was unregistered already (or never registered).

<CollapsibleDetails summaryTitle='Type definitions' open>
```tsx
type OutputEndCondition = {
  any_of?: string[];
  all_of?: string[];
  any_input?: bool;
  all_inputs?: bool;
}
```
</CollapsibleDetails>

### Properties

#### any_of
List of the input streams. The output stream will terminate if any stream in the list finishes.

- **Type**: `string[]`

---

#### all_of
List of the input streams. The output stream will terminate when all streams in the list finish.

- **Type**: `string[]`

---

#### any_input
Terminate the output stream if any of the input streams end, including streams added after the output was registered. Notably, the output stream will not terminate if no inputs were ever connected.

- **Type**: `bool`

---

#### all_inputs
Terminate the output stream only when all input streams have finished. Notably, the output stream will terminate if no inputs were ever connected.

- **Type**: `bool`
