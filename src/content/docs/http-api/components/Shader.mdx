---
title: Shader
---
import CollapsibleDetails from '../../../../components/CollapsibleDetails.astro';
import { Aside, Code } from '@astrojs/starlight/components';

Applies shader transformations to its children using a WGSL shader. For more information on using shaders in Smelter, please visit [Shaders documentation.](/fundamentals/concepts/shaders)


<Aside> To use this component, you need to first register the shader with matching `shader_id` using [`register shader`](/http-api/routes#register-shader) request. </Aside>

## Example

To use a shader, it must first be registered. To do this, send a request where the `source` field contains the shader WGSL code as a string.

<CollapsibleDetails summaryTitle='Register shader' open>
<Code code={`
POST: /api/shader/example_shader/register
Content-Type: application/json

{
    "source": "shader_code_as_string",
}
`} lang='http' />
</CollapsibleDetails> 

<CollapsibleDetails summaryTitle='Register MP4 input on which the shader will be applied' open>
<Code code={`
POST: /api/input/example_input/register
Content-Type: application/json

{
    "type": "mp4",
    "url":"https://example.com/video.mp4"
}
`} lang='http' />
</CollapsibleDetails>

Now, configure an output stream where the shader-processed video will be streamed.

<CollapsibleDetails summaryTitle='Register RTP output' open>
<Code code={`
POST: /api/output/example_output/register
Content-Type: application/json

{
    "type": "rtp_stream",
    "port": 8004,
    "ip": "127.0.0.1",
    "video": {
        "resolution": {
            "width": 1920,
            "height": 1080,
        },
        "encoder": {
            "type": "ffmpeg_h264",
            "preset": "ultrafast"
        },
        "initial": {
            "root": {
                "type": "shader",
                "id": "shader_node_1",
                "shader_id": "example_shader",
                "children": [
                    {
                        "id": "input_1",
                        "type": "input_stream",
                        "input_id": "example_input",
                    }
                ],
                "resolution": { "width": 1920, "height": 1080 },
            }
        }
    }
}
`} lang='http' ins={{range: '19-29'}}/>
</CollapsibleDetails>

Once all components are registered, send a [start request](/http-api/routes#start-request) to initiate the stream. The processed output will be streamed via RTP on port 8004.

<CollapsibleDetails summaryTitle='Type definitions'>
<Code code={`
type Shader = {
    id?: string;
    children?: Component[];
    shader_id: string;
    shader_param?: ShaderParam;
    resolution: {
      width: u32;
      height: u32;
    };
}
`} lang='tsx' />
</CollapsibleDetails>


## Properties
### id
ID of a component.

- **Type**: `string`

---

### children
A single child component to be transformed.

- **Type**: `Component[]`

---

### shader_id
ID of a shader. It identifies a shader registered using a [register shader](/http-api/routes#register-shader) method.

- **Type**: `string`

---

### shaderParam
Object that will be serialized into a struct and passed to the shader as `@group(1) @binding(0) var<uniform>`. ShaderParam object must match the structure defined in a shader source code.

- **Type**: [`ShaderParam`](#shaderparam-1)

<Aside>Right now, we don't handle memory layout automatically. To get the correct memory alignment, you might need to add some extra fields as padding. Visit the <a href="https://www.w3.org/TR/WGSL/#alignment-and-size" target='_blank'>WGSL documentation</a> for more details.</Aside>

---

### resolution
Resolution of the texture where shader will be executed.

- **Type**: `{ width: u32; height: u32;}`

## ShaderParam
```typescript
type ShaderParam = 
  | { type: "f32"; value: f32; }
  | { type: "u32"; value: u32; }
  | { type: "i32"; value: i32; }
  | { type: "list"; value: ShaderParam[]; }
  | {
      type: "struct";
      value: ShaderParamStructField[];
    }
```

## ShaderParamStructField
```typescript
type ShaderParamStructField = 
  | { field_name: string; type: "f32"; value: f32; }
  | { field_name: string; type: "u32"; value: u32; }
  | { field_name: string; type: "i32"; value: i32; }
  | {
      field_name: string;
      type: "list";
      value: ShaderParam[];
    }
  | {
      field_name: string;
      type: "struct";
      value: ShaderParamStructField[];
    }
```
