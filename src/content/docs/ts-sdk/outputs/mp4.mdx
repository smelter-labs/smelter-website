---
title: MP4
---
import { Aside, Code } from '@astrojs/starlight/components';
import CollapsibleDetails from '../../../../components/CollapsibleDetails.astro';

An output type that allows saving video and audio from the compositor to MP4 file.

<Code code={`import type { Outputs } from "@swmansion/smelter"`} lang='tsx' />

## Outputs.RegisterMp4Output
Parameters for an output stream to MP4 file.

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type RegisterMp4Output = {
    serverPath: string;
    video?: Outputs.Mp4VideoOptions;
    audio?: Outputs.Mp4AudioOptions;
}
`} lang='tsx' />
</CollapsibleDetails>

### Properties

#### serverPath
Path to the MP4 file, specifying its location on the server where the Smelter is deployed.

- **Type**: `string`

---

#### video
Video track configuration.

- **Type**: `Mp4VideoOptions`

---

#### audio
Audio track configuration.

- **Type**: `Mp4AudioOptions`

## Mp4VideoOptions
Video track configuration options.

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type Mp4VideoOptions = {
    resolution: {
      width: number;
      height: number;
    };
    sendEosWhen?: Outputs.OutputEndCondition;
    encoder: Outputs.Mp4VideoEncoderOptions;
    root: React.ReactElement;
}
`} lang='tsx' />
</CollapsibleDetails>

### Properties

#### resolution
Output resolution in pixels.

- **Type**: `{ width: number; height: number;}`

---

#### sendEosWhen
Condition for termination of the output stream based on the input streams states. If output includes both audio and video streams, then EOS needs to be sent for every type.

- **Type**: [`OutputEndCondition`](/ts-sdk/outputs/mp4#outputendcondition)

---

#### encoder
Video encoder options.

- **Type**: [`Mp4VideoEncoderOptions`](/ts-sdk/outputs/mp4#mp4videoencoderoptions)

---

#### root
Root of a component tree/scene that should be rendered for the output.

- **Type**: `ReactNode`

## Mp4VideoEncoderOptions
Configuration for the video encoder, based on the selected codec.

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type Mp4VideoEncoderOptions = {
      type: "ffmpeg_h264";
      preset: 
        | "ultrafast"
        | "superfast"
        | "veryfast"
        | "faster"
        | "fast"
        | "medium"
        | "slow"
        | "slower"
        | "veryslow"
        | "placebo";
      ffmpegOptions?: Map<string, string>;
    }
`} lang='tsx' />
</CollapsibleDetails>

### Properties (type: “ffmpeg_h264”)

#### preset
Video output encoder preset. Visit <a href='https://trac.ffmpeg.org/wiki/Encode/H.264#Preset' target='_blank'>FFmpeg docs</a> to learn more.

- **Type**: `"ultrafast" | "superfast" | "veryfast" | "faster" | "fast" | "medium" | "slow" | "slower" | "veryslow" | "placebo"`
- **Default value**: `fast`
- **Supported values**:
    - `ultrafast`
    - `superfast`
    - `veryfast`
    - `faster`
    - `fast`
    - `medium`
    - `slow`
    - `slower`
    - `veryslow`
    - `placebo`

---

#### ffmpegOptions
Raw FFmpeg encoder options. Visit <a href='https://ffmpeg.org/ffmpeg-codecs.html' target='_blank'>FFmpeg docs</a> to learn more.

- **Type**: `Map<string, string>`

## Mp4AudioOptions
Parameters of an audio source included in the stream.

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type Mp4AudioOptions = {
    mixingStrategy?: "sum_clip" | "sum_scale";
    sendEosWhen?: Outputs.OutputEndCondition;
    encoder: Outputs.Mp4AudioEncoderOptions;
    initial: {
      inputs: Outputs.InputAudio[];
    };
}
`} lang='tsx' />
</CollapsibleDetails>

### Properties

#### mixingStrategy
Specifies how audio should be mixed.

- **Type**: `"sum_clip" | "sum_scale"`
- **Default value**: `"sum_clip"`
- **Supported values**:
    - `sum_clip` - First, the input samples are summed. If the result exceeds the i16 PCM range, it is clipped.
    - `sum_scale` - First, the input samples are summed. If the result exceeds the i16 PCM range, the summed samples are scaled down by a factor to fit within the range.

---

#### sendEosWhen
Condition for termination of the output stream based on the input streams states. If output includes both audio and video streams, then EOS needs to be sent for every type.

- **Type**: [`OutputEndCondition`](/ts-sdk/outputs/mp4#outputendcondition)

---

#### encoder
Audio encoder options.

- **Type**: [`Mp4AudioEncoderOptions`](/ts-sdk/outputs/mp4#mp4audioencoderoptions)

---

#### initial
Initial audio mixer configuration for the output.

- **Type**: [`{inputs: InputAudio[]}`](/ts-sdk/outputs/mp4#inputaudio)

## Mp4AudioEncoderOptions
Configuration for the audio encoder, based on the selected codec.

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type Mp4AudioEncoderOptions = {
    type: "aac";
    channels: "mono" | "stereo";
}
`} lang='tsx' />
</CollapsibleDetails>

### Properties(type: "aac")

#### channels
Channels configuration

- **Type**: `"mono" | "stereo"`
- **Supported values**:
    - `mono` - Mono audio (single channel).
    - `stereo` - Stereo audio (two channels).

## OutputEndCondition
Defines when the output stream should end based on the state of the input streams. Only one of the nested fields can be set at a time. 

By default, the input stream is considered finished/ended when:
- TCP connection was dropped/closed.
- RTCP Goodbye packet (BYE) was received.
- MP4 track has ended.
- Input was unregistered already (or never registered).

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type OutputEndCondition = 
    | { anyOf: string[]; }
    | { allOf: string[]; }
    | { anyInput: boolean; }
    | { allInputs: boolean; };
`} lang='tsx' />
</CollapsibleDetails>

### Properties

#### anyOf
List of the input streams. The output stream will terminate if any stream in the list finishes.

- **Type**: `string[]`

---

#### allOf
List of the input streams. The output stream will terminate when all streams in the list finish.

- **Type**: `string[]`

---

#### anyInput
Terminate the output stream if any of the input streams end, including streams added after the output was registered. Notably, the output stream will not terminate if no inputs were ever connected.

- **Type**: `boolean`

---

#### allInputs
Terminate the output stream only when all input streams have finished. Notably, the output stream will terminate if no inputs were ever connected.

- **Type**: `boolean`

## InputAudio
Audio input information.

<CollapsibleDetails summaryTitle='Type definitions' open>
<Code code={`
type InputAudio = {
    inputId: string;
    volume?: number;
}
`} lang='tsx' />
</CollapsibleDetails>

### Properties

#### inputId
ID of an input. It identifies a stream registered using a [Smelter.registerInput](/ts-sdk/live-compositor#registerinput) method.

- **Type**: `string`

---

#### volume
Number between 0 and 1 representing the audio volume

- **Type**: `number`
